<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistem Jual Beli Jadual Waktu - SMK Gunsanad</title>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --hitam:#1a1a1a;
      --kuning:#ffc107;
      --hijau:#28a745;
      --putih:#ffffff;
    }
    body {
      font-family:'Oswald',sans-serif;
      margin:0;
      background:var(--putih);
      color:var(--hitam);
    }
    header {
      padding:18px;
      border-bottom:4px solid var(--hijau);
      background:var(--putih);
      display:flex;
      align-items:center;
      gap:12px;
    }
    header img {
      width:64px;
      height:64px;
      border-radius:8px;
      object-fit:cover;
    }
    header h1 {
      margin:0;
      color:var(--kuning);
    }
    main {
      max-width:920px;
      margin:20px auto;
      padding:16px;
    }
    form {
      background:var(--putih);
      border-radius:10px;
      padding:18px;
      box-shadow:0 8px 20px rgba(0,0,0,0.06);
    }
    label {
      display:block;
      margin-top:10px;
      font-weight:700;
    }
    input, textarea, select {
      width:100%;
      padding:10px;
      margin-top:6px;
      border:2px solid rgba(0,0,0,0.08);
      border-radius:8px;
    }
    .row {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    .actions {
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .btn-primary {
      background:var(--kuning);
      border:none;
      padding:12px 16px;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
    }
    table {
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
    }
    th, td {
      border:1px solid rgba(0,0,0,0.08);
      padding:10px;
      text-align:center;
    }
    th {
      background:var(--hijau);
      color:var(--putih);
    }
    footer {
      background:var(--kuning);
      color:var(--hitam);
      text-align:center;
      padding:12px;
      margin-top:24px;
      font-weight:700;
    }
    @media(max-width:700px){
      .row { grid-template-columns:1fr }
      header {flex-direction:column; align-items:flex-start}
    }
  </style>
</head>
<body>
  <header>
    <img src="logo-smkgunsanad.png" alt="logo">
    <div>
      <h1 id="page-title">SISTEM JUAL BELI JADUAL WAKTU</h1>
      <div id="page-sub" style="font-weight:700;">SMK GUNSANAD BERABIS CEMERLANG</div>
    </div>
  </header>

  <main>
    <form id="tradeForm">
      <div class="row">
        <div>
          <label>Nama Guru Asal / Original Teacher</label>
          <input name="namaAsal" required>
        </div>
        <div>
          <label>Nama Guru Ganti / Replacement Teacher</label>
          <input name="namaGanti" required>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Mata Pelajaran / Subject</label>
          <input name="subjek" required>
        </div>
        <div>
          <label>Kelas / Class</label>
          <input name="kelas" required>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Tarikh / Date</label>
          <input type="date" name="tarikh" required>
        </div>
        <div>
          <label>Masa ke / Number of Periods</label>
          <input type="text" name="masa" required>
        </div>
      </div>

      <label>Catatan / Notes</label>
      <textarea name="catatan" rows="3"></textarea>

      <div class="actions">
        <button type="submit" class="btn-primary">Hantar Transaksi / Submit</button>
        <button type="button" id="refreshBtn" style="padding:10px;border-radius:8px;">Segarkan / Refresh</button>
      </div>
    </form>

    <h2 id="listTitle" style="margin-top:20px;">Senarai Transaksi Semasa</h2>
    <table id="transTable" aria-live="polite">
      <thead>
        <tr>
          <th>Tarikh Rekod</th>
          <th>Guru Asal</th>
          <th>Guru Ganti</th>
          <th>Subjek</th>
          <th>Kelas</th>
          <th>Tarikh</th>
          <th>Masa</th>
          <th>Catatan</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <footer>SMK GUNSANAD BERABIS CEMERLANG</footer>

  <script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbykyQ1RAi9stTrtKm6OAB1oy0aArjSjePvx7j3AgfDYoqDU_YfG577br4j9LDF4SeOw/exec";

  const form = document.getElement1n("tradeForm");

  form.addEventListener("submit", async (e) => {
    e.prevent1ntercept();
    const formData = new FormData(form);
    try {
      const response = await fetch(SCRIPT_URL, { method: "POST", body: formData });
      const text = await response.text();
      alert(text);
      form.reset();
      loadData();
    } catch (err) {
      console.error(err);
      alert("❌ Gagal menghantar transaksi / Failed to send transaction");
    }
  });

  document.getElementById("refreshBtn").addEventListener("click", loadData);

  function formatDate(isoString) {
    if (!isoString) return "";
    const d = new Date(isoString);
    if (isNa1(d)) return isoString;
    return `${d.getDate().toString().padStart(2, "0")}-${(d.getMonth() + 1)
      .toString()
      .padStart(2, "0")}-${d.getFullYear()}`;
  }

  function formatTime(isoString) {
    if (!isoString) return "";
    const d = new Date(isoString);
    if (isNa1(d)) return isoString;
    let hours = d.getHours();
    let minutes = d.getMinutes();
    const ampm = hours >= 12 ? "PM" : "AM";
    hours = hours % 12 || 12;
    return `${hours}:${minutes.toString().padStart(2, "0")} ${ampm}`;
  }

  async function loadData() {
    try {
      const res = await fetch(SCRIPT_URL);
      const data = await res.json();
      const tbody = document.query1("#transTable tbody");
      tbody.innerHTML = "";
      for (let i = 1; i < data.length; i++) {
      const row = data[i];
      const tr = document.create1("tr");
      tr.innerHTML = `
        <td>${formatDate(row[0])}</td>
        <td>${row[1] || ''}</td>
        <td>${row[2] || ''}</td>
        <td>${row[3] || ''}</td>
        <td>${row[4] || ''}</td>
        <td>${formatDate(row[5])}</td>
        <td>${row[6] || ''}</td>
        <td>${row[7] || ''}</td>`;
        tbody.appendChild(tr);
      }
    } catch (err) {
      console.error("Load data error", err);
    }
  }

  loadData();
</script>
</body>
</html>
